<br>

<p align="center">
<img width="500" src="https://github.com/user-attachments/assets/7db9446e-f2e4-4e36-8b1e-7e139a2a7c22" alt="Microsoft Active Directory Logo"/>
<br>

<br>



<h1>Vulnerability Management Lab with OpenVAS & Azure</h1>
<br>

<h2>Understanding the Scenario</h2>

<br>

‚û°Ô∏è In this Project we're going to be build a **Vulnerability Management Technical Lab in the Cloud**.

<br>

1. First, we're going to **Create a Vulnerability Management Server using Openvas**.

2. Then, we'll **Create a Virtual Machine using Azure**.

3. After that, we're going to **Install some Insecure Software** on the VM.

4. Finally we'll **perform some Scans and do some Remediation** on the compromised VM.


<br>

<p align="center">
<img src="https://github.com/user-attachments/assets/d97469d1-123c-4ac7-a14e-8d3c5783c8fb" height="80%" width="80%" alt="9"/><br />

<br>
<br>

<br>

<h2>Prerequisites</h2>
<br>

- Computer with an Internet Connection
- Azure Account

<br>

<h2></h2>

<details close> 
<summary> <h2>1Ô∏è‚É£ Create our Free Azure Account</h2> </summary>
<br>

Sign up to an [Azure Free Account](https://azure.microsoft.com/en-us/free/)
<p align="center">
<img src="https://github.com/user-attachments/assets/92f3044d-de80-417e-ac61-07d501ce8a32" height="80%" width="80%" alt="9"/><br />
<br>

Login to the [Azure Portal](https://portal.azure.com)
<p align="center">
<img src="https://github.com/user-attachments/assets/77ed5891-3a5a-4ad4-9449-4318ed9c8e10" height="80%" width="80%" alt="9"/><br />
<br>
   
<br>

  </details>

<h2></h2>

<details close> 
<summary> <h2>2Ô∏è‚É£ Prepare the Vulnerability Management Scanner</h2> </summary>
<br>

Go to the [Azure Portal](https://portal.azure.com)

Navigate to the Marketplace and search for **"OpenVAS secured and supported by HOSSTED"**
<p align="center">
<img src="https://github.com/user-attachments/assets/cdc5b03e-e5b0-43b0-8c44-20b261373bc8" height="80%" width="80%" alt="9"/><br />
<br>

<p align="center">
<img src="https://github.com/user-attachments/assets/0512a583-e0b2-411b-bacb-22d2a18c2868" height="70%" width="70%" alt="9"/><br />
<br>

Choose the **"Start with a pre-set configuration"** option and select the weakest configuration (**"General purpose (D-Series)"**)

Click **"Continue to Create VM"**
<p align="center">
<img src="https://github.com/user-attachments/assets/3a2be4c2-302d-4c4a-801b-b0a8815e2488" height="80%" width="80%" alt="9"/><br />
<br>

<p align="center">
<img src="https://github.com/user-attachments/assets/04e03193-3621-48c7-a116-c786ae1048d6" height="70%" width="70%" alt="9"/><br />
<br>

Configure the VM:
   - Resource Group: **Vulnerability-Management**
   - VM Name: **OpenVAS** (Take note of the Region and Vnet ‚ûî consider **East US 2**)
   - Authentication: Username ‚ûî **azureuser** / Password ‚ûî **Cyberlab123!**

<p align="center">
<img src="https://github.com/user-attachments/assets/4eb6905d-6686-49fd-b266-5ce8357149a3" height="70%" width="70%" alt="9"/><br />
<br>

   - Monitoring Tab: Boot Diagnostic ‚ûî **Disable**

Click **"Create"** to create the VM.
<p align="center">
<img src="https://github.com/user-attachments/assets/7de26e9d-4c59-4019-a79b-728d9e454435" height="70%" width="70%" alt="9"/><br />
<br>

<h2></h2>
<br>

Once the deployment is complete, you can click on the **OpenVAS VM Server** we just created and copy its **Public IP Address**.
<p align="center">
<img src="https://github.com/user-attachments/assets/2f838518-683d-4a2f-8d91-5a37952150e5" height="70%" width="70%" alt="9"/><br />
<br>
   
Using the VMs Public IP Address, we'll **SSH into it using PowerShell (Windows) or Terminal (MacOS)** with the credentials we set up earlier.
<p align="center">
<img src="https://github.com/user-attachments/assets/5491a8ee-4df1-4524-92db-56933e86ea05" height="90%" width="90%" alt="9"/><br />
<br>

Terminal will ask you if you want to accept the fingerprint (basically so that your computer doesn't recognize that the server is being used for SSH) ‚ûî Type **"Yes"**.
<p align="center">
<img src="https://github.com/user-attachments/assets/5ac5beba-c560-42a9-953c-da0a973c8b88" height="90%" width="90%" alt="9"/><br />
<br>

Then it will ask you for the Password ‚ûî Type **Cyberlab123!** (the password won't be shown in the command line for security reasons).
<p align="center">
<img src="https://github.com/user-attachments/assets/9cbe5801-1490-4f2b-8b78-f393ab134819" height="90%" width="90%" alt="9"/><br />
<br>

We'll now just leave the window open and wait for a bit while the OpenVAS is being deployed.
<p align="center">
<img src="https://github.com/user-attachments/assets/3c19799f-6ca7-4b9d-8ca7-dbfe3e869172" height="90%" width="90%" alt="9"/><br />
<br>

After around 2 to 3 minutes you'll notice a message with a **Username** and **Password**.

Write it down ‚ûî these are the **OpenVAS Web App Credentials**
<p align="center">
<img src="https://github.com/user-attachments/assets/c61c5aa9-dce5-449b-99f1-50dce5e4738b" height="90%" width="90%" alt="9"/><br />
<br>

>   <details close> 
>   
> **<summary> üí° Note</summary>**
> 
> If you try to login using this password and it doesn't work, try using the pasword **"admin"** and it should let you login.
> 
> Then after we're logged in we can change the password to the one that was given to us.
> 
>   </details>

<br>

Now we'll just let it finish setting up.
<p align="center">
<img src="https://github.com/user-attachments/assets/eda93a9a-3348-4603-a052-1d6abddfb34f" height="90%" width="90%" alt="9"/><br />
<br>

<h2></h2>
<br>

If you scroll up you can see that it gives us a **URL** ‚ûî this is for the **Openvas Web Server** that we're going to log into.
<p align="center">
<img src="https://github.com/user-attachments/assets/6a4f7cc9-bccb-4bef-8842-64ded74de361" height="90%" width="90%" alt="9"/><br />
<br>

We'll copy that URL and open it in a new tab ‚ûî this is our **Vulnerability Management Platform**.
<p align="center">
<img src="https://github.com/user-attachments/assets/e0c34343-fb5b-4e10-8062-c2560e0d2bc0" height="80%" width="80%" alt="9"/><br />
<br>

After we login, we can reset the password if we weren't able to login with the original one, and had to use **"Admin** as the pasword:
<p align="center">
<img src="https://github.com/user-attachments/assets/3b37e124-e61b-482b-9c67-4d8ec8ddf969" height="80%" width="80%" alt="9"/><br />
<br>

<br>

  </details>

<h2></h2>

<details close> 
<summary> <h2>3Ô∏è‚É£ Create Client Virtual Machine and Make it Vulnerable</h2> </summary>
<br>

Go to [Azure Portal](https://portal.azure.com)

Search for Virtual Machines and **create a new Virtual Machine**.
<p align="center">
<img src="https://github.com/user-attachments/assets/c41919af-3e76-431b-a837-138bf7050f87" height="80%" width="80%" alt="9"/><br />
<br>

<p align="center">
<img src="https://github.com/user-attachments/assets/0ee119a7-8941-4ca5-9621-95dc70a9a609" height="70%" width="70%" alt="9"/><br />
<br>

Configure the VM:
   - Resource Group: **Vulnerability-Management**
   - VM Name: **Win10-Vulnerable**
   - Region: Same as the OpenVAS VM ‚ûî **East US 2**
   - Image: **Windows 10 Pro**
   - Size: Any size with at least **2 vCPUs**
   - Authentication: Username ‚ûî **azureuser** / Password ‚ûî **Cyberlab123!**
<p align="center">
<img src="https://github.com/user-attachments/assets/25242632-a461-4e73-a96a-f980339ada50" height="70%" width="70%" alt="9"/><br />
<br>

   - Networking Tab: Virtual Network ‚ûî **OpenVas-vnet** (Same as OpenVAS)

Create the VM.
<p align="center">
<img src="https://github.com/user-attachments/assets/7ae2f5c8-f175-4ed4-9c29-56fc575e2535" height="70%" width="70%" alt="9"/><br />
<br>

<h2></h2>
<br>

Once the VM is created, ensure you can **RDP into it with the provided credentials**.

First we'll open our Windows 10 Virtual Machine and copy its **Public IP Address**:
<p align="center">
<img src="https://github.com/user-attachments/assets/959dc942-7a9b-4d16-b85d-3111886dff5b" height="70%" width="70%" alt="9"/><br />
<br>

<p align="center">
<img src="https://github.com/user-attachments/assets/e8ebc9d4-69a3-4d17-9265-8d40445326b2" height="80%" width="80%" alt="9"/><br />
<br>

Since I was using a Mac OS during this project, I used the **Microsoft Remote Desktop** app to establish the RDP connection (if you're using Windows you can just use the MSTSC command).

Click on **"Add PC"** 
<p align="center">
<img src="https://github.com/user-attachments/assets/e066ffd3-be86-4e91-b0d9-ee8c7c113e78" height="70%" width="70%" alt="9"/><br />
<br>

Then paste the Public IP Address of our Windows 10 VM.
<p align="center">
<img src="https://github.com/user-attachments/assets/bb7b332f-5a4d-4b6c-8663-b9959ca43a4b" height="70%" width="70%" alt="9"/><br />
<br>

Next we double click the box with the IP and type in our **Username and Password** (from the **Win10-Vulnerable** VM):
<p align="center">
<img src="https://github.com/user-attachments/assets/066feaa8-acaa-425d-b31f-4e0b94f3d8a7" height="70%" width="70%" alt="9"/><br />
<br>

<p align="center">
<img src="https://github.com/user-attachments/assets/944f062a-bc79-4053-9fb8-38b9cf29dec4" height="80%" width="80%" alt="9"/><br />
<br>

Then we'll just connect to our Virtual Machine
<p align="center">
<img src="https://github.com/user-attachments/assets/4eb87ba0-b4cd-4994-8ad9-af688ab3ffab" height="80%" width="80%" alt="9"/><br />
<br>

<h2></h2>
<br>

After logging into the VM, we're going to **Make it Vulnerable**.

First we're going to **Disable the Firewall** in the VM, which will allow the Vulnerability Scanner to perform the Scans without traffic being dropped.

Using the **Start** button inside the VM, go to **Microsoft Common Console Document**.
<p align="center">
<img src="https://github.com/user-attachments/assets/ebb41c50-db7f-43c2-a9b0-79450e0cb5a6" height="70%" width="70%" alt="9"/><br />
<br>

Go to the **Firewall Poperties**, and **Turn Off the Firewall** for each one of the **Profiles**.
<p align="center">
<img src="https://github.com/user-attachments/assets/cfb86cc9-1118-4038-a7ae-92ed78b5bb0d" height="90%" width="90%" alt="9"/><br />
<br>

<p align="center">
<img src="https://github.com/user-attachments/assets/8f80dd63-25cd-418b-a423-f03a8ccb5155" height="100%" width="100%" alt="9"/><br />
<br>

<p align="center">
<img src="https://github.com/user-attachments/assets/e847ec08-522f-4c63-b73f-1e811e97c3f1" height="50%" width="50%" alt="9"/><br />
<br>

After that, using Microsoft Edge and the Google Drive link bellow, we're going to install old versions of 3 different softwares

[Old Software Versions of Firefox, VLC and Adobe Reader](https://drive.google.com/drive/u/0/folders/1n83ilCjZWZulbDdYnUe9wQPK2buY47_U)

<p align="center">
<img src="https://github.com/user-attachments/assets/b7ed5cfe-b00d-4000-9298-5a8522d1083c" height=70%" width="70%" alt="9"/><br />
<br>

<p align="center">
<img src="https://github.com/user-attachments/assets/2ea89565-2c76-48d3-bc71-c7a61ae2d1f0" height="100%" width="100%" alt="9"/><br />
<br>

It might take a while, but just go trough the process of downloading each one of the softwares.
<p align="center">
<img src="https://github.com/user-attachments/assets/b1018e69-6380-40ff-b43d-efa58ae7e7cd" height="100%" width="100%" alt="9"/><br />
<br>

<p align="center">
<img src="https://github.com/user-attachments/assets/f2f22ecb-824c-4505-a503-f695c4eb07d0" height="100%" width="100%" alt="9"/><br />
<br>

Then we'll just **restart** or Windows 10 Virtual Machine.
<p align="center">
<img src="https://github.com/user-attachments/assets/8ccd0671-c471-4bd9-bc96-2cfff4884ef6" height="60%" width="60%" alt="9"/><br />
<br>

<br>

  </details>

<h2></h2>

<details close> 
<summary> <h2>4Ô∏è‚É£ Configure OpenVAS to Perform First Unauthenticated Scan against our Vulnerable VM</h2> </summary>
<br>

Login to **OpenVAS** and navigate to **Assets** ‚ûî **Hosts** ‚ûî **New Host**.
<p align="center">
<img src="https://github.com/user-attachments/assets/8ccd0671-c471-4bd9-bc96-2cfff4884ef6" height="60%" width="60%" alt="9"/><br />
<br>

<p align="center">
<img src="https://github.com/user-attachments/assets/8ccd0671-c471-4bd9-bc96-2cfff4884ef6" height="60%" width="60%" alt="9"/><br />
<br>

<p align="center">
<img src="https://github.com/user-attachments/assets/8ccd0671-c471-4bd9-bc96-2cfff4884ef6" height="60%" width="60%" alt="9"/><br />
<br>

Then we have to go back to the Azure Portal to get the **Private IP Address** of our **Windows 10 machine**.
<p align="center">
<img src="https://github.com/user-attachments/assets/8ccd0671-c471-4bd9-bc96-2cfff4884ef6" height="60%" width="60%" alt="9"/><br />
<br>

<p align="center">
<img src="https://github.com/user-attachments/assets/8ccd0671-c471-4bd9-bc96-2cfff4884ef6" height="60%" width="60%" alt="9"/><br />
<br>

We are then going to create a **New Target** from the Host ‚ûî name it **"Azure Vulnerable VMs"**.

(Take note of the credentials. We will add SMB credentials later.)
<p align="center">
<img src="https://github.com/user-attachments/assets/8ccd0671-c471-4bd9-bc96-2cfff4884ef6" height="60%" width="60%" alt="9"/><br />
<br>

<p align="center">
<img src="https://github.com/user-attachments/assets/8ccd0671-c471-4bd9-bc96-2cfff4884ef6" height="60%" width="60%" alt="9"/><br />
<br>

Then we'll **Create a New Task**:
   - Name & Comment: **"Scan - Azure Vulnerable VMs"**
   - Scan Targets: **"Azure Vulnerable VMs"**

Save the Task.
<p align="center">
<img src="https://github.com/user-attachments/assets/8ccd0671-c471-4bd9-bc96-2cfff4884ef6" height="60%" width="60%" alt="9"/><br />
<br>

<p align="center">
<img src="https://github.com/user-attachments/assets/8ccd0671-c471-4bd9-bc96-2cfff4884ef6" height="60%" width="60%" alt="9"/><br />
<br>

After our Task is created, we can click the ‚ñ∑ play button to start the Task **"Scan - Azure Vulnerable VMs"** of scanning our host machine that we added.
<p align="center">
<img src="https://github.com/user-attachments/assets/8ccd0671-c471-4bd9-bc96-2cfff4884ef6" height="60%" width="60%" alt="9"/><br />
<br>

This might take a while, so keep an eye on the status progress bar to see when it's completed.

Once the scan is finished, click the date under **‚ÄúLast Report‚Äù** to see the results.
<p align="center">
<img src="https://github.com/user-attachments/assets/8ccd0671-c471-4bd9-bc96-2cfff4884ef6" height="60%" width="60%" alt="9"/><br />
<br>

Take note of the Tabs, specifically the **‚ÄúResults‚Äù** tab.
<p align="center">
<img src="https://github.com/user-attachments/assets/8ccd0671-c471-4bd9-bc96-2cfff4884ef6" height="60%" width="60%" alt="9"/><br />
<br>

> üí° Even though we installed the insecure old versions of Firefox, VLC player and Adobe Reader ‚ûî it does not show up here as Vulnerabilities.
> 
> This is because we aren‚Äôt running a **Credentialed Scan**, so the scanner could not discover it.
> 
> We will configure Credential Scans next
<br>

<br>

  </details>

<h2></h2>

<details close> 
<summary> <h2>5Ô∏è‚É£ Make Configurations for Credentialed Scans ‚ûî in our Vulnerable VM</h2> </summary>
<br>

<br>

> The next thing to do is make some configurations in our **Windows 10 Virtual Machine**, which will allow us to do **Authenticated Scans against the Windows Virtual Machine**.
> 
> <br>
> 
> After that we're going to perform another scan, but this one is going to be authenticated ‚ûî and then we'll **Compare the Results of both Scans**.
<br>

<br>

1. **Disable Windows Firewall** ‚ûî which we've done before, so we'll just confirm it is indeed turned off:
<p align="center">
<img src="https://github.com/user-attachments/assets/8ccd0671-c471-4bd9-bc96-2cfff4884ef6" height="60%" width="60%" alt="9"/><br />
<br>

<h2></h2>

<br>

2. **Disable User Account Control** ‚ûî go to **"Change User Account Crontol Setting"** ‚ûî and Turn Down the Notification to **"Never Notify"**
<p align="center">
<img src="https://github.com/user-attachments/assets/8ccd0671-c471-4bd9-bc96-2cfff4884ef6" height="60%" width="60%" alt="9"/><br />
<br>

<p align="center">
<img src="https://github.com/user-attachments/assets/8ccd0671-c471-4bd9-bc96-2cfff4884ef6" height="60%" width="60%" alt="9"/><br />
<br>

<h2></h2>

<br>

3. **Enable Remote Registry** ‚ûî go to the **"Services"** app
<p align="center">
<img src="https://github.com/user-attachments/assets/8ccd0671-c471-4bd9-bc96-2cfff4884ef6" height="60%" width="60%" alt="9"/><br />
<br>

‚ûî Find **"Remote Registry"** and double-click it
<p align="center">
<img src="https://github.com/user-attachments/assets/8ccd0671-c471-4bd9-bc96-2cfff4884ef6" height="60%" width="60%" alt="9"/><br />
<br>
   
‚ûî Change *"Startup type"* from **Disabled** to **Automatic** ‚ûî click **"Apply"** and then **"Start"**
<p align="center">
<img src="https://github.com/user-attachments/assets/8ccd0671-c471-4bd9-bc96-2cfff4884ef6" height="60%" width="60%" alt="9"/><br />
<br>

<p align="center">
<img src="https://github.com/user-attachments/assets/8ccd0671-c471-4bd9-bc96-2cfff4884ef6" height="60%" width="60%" alt="9"/><br />
<br>
   
‚ûî Click **"OK"** once it's finished and then close the **"Services"** app
<p align="center">
<img src="https://github.com/user-attachments/assets/8ccd0671-c471-4bd9-bc96-2cfff4884ef6" height="60%" width="60%" alt="9"/><br />
<br>

<h2></h2>

<br>

4. **Set Registry Key** ‚ûî Launch **Registry Editor** (regedit.exe)

- üí° "Run as Administrator" and grant Admin Approval, if requested.
<p align="center">
<img src="https://github.com/user-attachments/assets/8ccd0671-c471-4bd9-bc96-2cfff4884ef6" height="60%" width="60%" alt="9"/><br />
<br>

‚ûî Navigate to the **HKEY_LOCAL_MACHINE** hive ‚ûî Open the **SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System** key.
<p align="center">
<img src="https://github.com/user-attachments/assets/8ccd0671-c471-4bd9-bc96-2cfff4884ef6" height="60%" width="60%" alt="9"/><br />
<br>

<p align="center">
<img src="https://github.com/user-attachments/assets/8ccd0671-c471-4bd9-bc96-2cfff4884ef6" height="60%" width="60%" alt="9"/><br />
<br>

‚ûî Create a new **DWORD (32-bit) value** with the following properties:
- Name: **LocalAccountTokenFilterPolicy**
- Value: **1**
<p align="center">
<img src="https://github.com/user-attachments/assets/8ccd0671-c471-4bd9-bc96-2cfff4884ef6" height="60%" width="60%" alt="9"/><br />
<br>


**Close Registry Editor** and **Restart the VM**.
<p align="center">
<img src="https://github.com/user-attachments/assets/8ccd0671-c471-4bd9-bc96-2cfff4884ef6" height="60%" width="60%" alt="9"/><br />
<br>

<br>

  </details>

<h2></h2>

<details close> 
<summary> <h2>6Ô∏è‚É£ Make Configurations for Credentialed Scans ‚ûî inside OpenVAS</h2> </summary>
<br>







### Make Configurations for Credentialed Scans (OpenVAS)
<img width="722" alt="image" src="https://github.com/joshmadakor1/openvas/assets/39254979/474cb714-19ad-4c99-8e60-945a2a12d7e5">

1. Go to Configuration > Credentials > New Credential.
2. Name / Comment: "Azure VM Credentials".
3. Allow Insecure Use: Yes.
4. Username: azureuser.
5. Password: Cyberlab123!
6. Save.
7. Go to Configuration > Targets > CLONE the Target we made before.
8. NEW Name / Comment: "Azure Vulnerable VMs - Credentialed Scan".
9. Ensure the Private IP is still accurate.
10. Credentials > SMB > Select the Credentials we just made: Azure VM Credentials.
11. Save.

### Execute Credentialed Scan against our Vulnerable Windows VM
<img width="1126" alt="image" src="https://github.com/joshmadakor1/openvas/assets/39254979/83467078-e917-4eba-9757-745fe47b4ebf">

<img width="861" alt="image" src="https://github.com/joshmadakor1/openvas/assets/39254979/3b5cf494-829c-4eb0-bcfd-6d4372c97cd6">

1. Within Greenbone / OpenVAS, go to Scans > Tasks.
2. CLONE the "Scan - Azure Vulnerable VMs" Task and Edit it.
3. Name / Comment: "Scan - Azure Vulnerable VMs - Credentialed".
4. Targets: Azure Vulnerable VMs - Credentialed Scan.
5. Save.
6. Click the Play button to launch the new Credentialed Scan and wait for it to finish.

### Remediate Vulnerabilities
<img width="799" alt="image" src="https://github.com/joshmadakor1/openvas/assets/39254979/6b3835dc-11b1-4e00-b7a5-baa8049182f7">

1. Log back into your Win10-Vulnerable VM.
2. Uninstall Adobe Reader, VLC Player, and Firefox.
3. Restart the VM.
4. Re-initiate the "Scan - Azure Vulnerable VMs - Credentialed" scan and observe the results.

### Verify Remediations
<img width="1120" alt="image" src="https://github.com/joshmadakor1/openvas/assets/39254979/9efbd193-002a-49c2-9d9e-51f2cf1dc2af">

1. Note that there are no longer Vulnerabilities for FireFox, VLC Player, or Adobe Reader!

<br>

<br>

<br>

<br>

<br>




