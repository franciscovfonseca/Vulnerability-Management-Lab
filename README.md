<br>

<p align="center">
<img width="500" src="https://github.com/user-attachments/assets/7db9446e-f2e4-4e36-8b1e-7e139a2a7c22" alt="Microsoft Active Directory Logo"/>
<br>

<br>



<h1>Vulnerability Management Lab with OpenVAS & Azure</h1>
<br>

<h2>Understanding the Scenario</h2>

<br>

‚û°Ô∏è In this Project we're going to be build a **Vulnerability Management Technical Lab in the Cloud**.

<br>

1. First, we're going to **Create a Vulnerability Management Server using Openvas**.

2. Then, we'll **Create a Virtual Machine using Azure**.

3. After that, we're going to **Install some Insecure Software** on the VM.

4. Finally we'll **perform some Scans and do some Remediation** on the compromised VM.


<br>

<p align="center">
<img src="https://github.com/user-attachments/assets/d97469d1-123c-4ac7-a14e-8d3c5783c8fb" height="80%" width="80%" alt="9"/><br />

<br>
<br>

<br>

<h2>Prerequisites</h2>
<br>

- Computer with an Internet Connection
- Azure Account ‚ûî might be possible to do with a Free Subscription

<br>


<h2>1Ô∏è‚É£ Create our Free Azure Account</h2>
<br>

Sign up to an [Azure Free Account](https://azure.microsoft.com/en-us/free/)
<p align="center">
<img src="https://github.com/user-attachments/assets/92f3044d-de80-417e-ac61-07d501ce8a32" height="80%" width="80%" alt="9"/><br />
<br>

Login to the [Azure Portal](https://portal.azure.com)
<p align="center">
<img src="https://github.com/user-attachments/assets/77ed5891-3a5a-4ad4-9449-4318ed9c8e10" height="80%" width="80%" alt="9"/><br />
<br>
   
<br>
<br>

<h2>2Ô∏è‚É£ Prepare the Vulnerability Management Scanner</h2>
<br>

Go to the [Azure Portal](https://portal.azure.com)

Navigate to the Marketplace and search for **"OpenVAS secured and supported by HOSSTED"**
<p align="center">
<img src="https://github.com/user-attachments/assets/cdc5b03e-e5b0-43b0-8c44-20b261373bc8" height="80%" width="80%" alt="9"/><br />
<br>

<p align="center">
<img src="https://github.com/user-attachments/assets/0512a583-e0b2-411b-bacb-22d2a18c2868" height="70%" width="70%" alt="9"/><br />
<br>

Choose the **"Start with a pre-set configuration"** option and select the weakest configuration (**"General purpose (D-Series)"**)

Click **"Continue to Create VM"**
<p align="center">
<img src="https://github.com/user-attachments/assets/3a2be4c2-302d-4c4a-801b-b0a8815e2488" height="80%" width="80%" alt="9"/><br />
<br>

<p align="center">
<img src="https://github.com/user-attachments/assets/04e03193-3621-48c7-a116-c786ae1048d6" height="70%" width="70%" alt="9"/><br />
<br>

Configure the VM:
   - Resource Group: **Vulnerability-Management**
   - VM Name: **OpenVAS** (Take note of the Region and Vnet ‚ûî consider **East US 2**)
   - Authentication: Username ‚ûî **azureuser** / Password ‚ûî **Cyberlab123!**

<p align="center">
<img src="https://github.com/user-attachments/assets/4eb6905d-6686-49fd-b266-5ce8357149a3" height="70%" width="70%" alt="9"/><br />
<br>

   - Monitoring: Boot Diagnostic ‚ûî **Disable**

Click **"Create"** to create the VM.
<p align="center">
<img src="https://github.com/user-attachments/assets/7de26e9d-4c59-4019-a79b-728d9e454435" height="70%" width="70%" alt="9"/><br />
<br>

<h2></h2>
<br>

Once the deployment is complete, you can click on the **OpenVAS VM Server** we just created and copy its **Public IP Address**.
<p align="center">
<img src="https://github.com/user-attachments/assets/2f838518-683d-4a2f-8d91-5a37952150e5" height="70%" width="70%" alt="9"/><br />
<br>
   
Using the VMs Public IP Address, we'll **SSH into it using PowerShell (Windows) or Terminal (MacOS)** with the credentials we set up earlier.
<p align="center">
<img src="https://github.com/user-attachments/assets/5491a8ee-4df1-4524-92db-56933e86ea05" height="90%" width="90%" alt="9"/><br />
<br>

Terminal will ask you if you want to accept the fingerprint (basically so that your computer doesn't recognize that the server is being used for SSH) ‚ûî Type **"Yes"**.
<p align="center">
<img src="https://github.com/user-attachments/assets/5ac5beba-c560-42a9-953c-da0a973c8b88" height="90%" width="90%" alt="9"/><br />
<br>

Then it will ask you for the Password ‚ûî Type **Cyberlab123!** (the password won't be shown in the command line for security reasons).
<p align="center">
<img src="https://github.com/user-attachments/assets/9cbe5801-1490-4f2b-8b78-f393ab134819" height="90%" width="90%" alt="9"/><br />
<br>

We'll now just leave the window open and wait for a bit while the OpenVAS is being deployed.
<p align="center">
<img src="https://github.com/user-attachments/assets/3c19799f-6ca7-4b9d-8ca7-dbfe3e869172" height="90%" width="90%" alt="9"/><br />
<br>

After around 2 to 3 minutes you'll notice a message with a **Username** and **Password**.

Write it down ‚ûî these are the **OpenVAS Web App Credentials**
<p align="center">
<img src="https://github.com/user-attachments/assets/c61c5aa9-dce5-449b-99f1-50dce5e4738b" height="90%" width="90%" alt="9"/><br />
<br>

>   <details close> 
>   
> **<summary> üí° Note</summary>**
> 
> If you try to login using this password and it doesn't work, try using the pasword **"admin"** and it should let you login.
> 
> Then after we're logged in we can change the password to the one that was given to us.
> 
>   </details>

<br>

Now we'll just let it finish setting up.
<p align="center">
<img src="https://github.com/user-attachments/assets/eda93a9a-3348-4603-a052-1d6abddfb34f" height="90%" width="90%" alt="9"/><br />
<br>

<h2></h2>
<br>

If you scroll up you can see that it gives us a **URL** ‚ûî this is for the **Openvas Web Server** that we're going to log into.
<p align="center">
<img src="https://github.com/user-attachments/assets/6a4f7cc9-bccb-4bef-8842-64ded74de361" height="90%" width="90%" alt="9"/><br />
<br>

We'll copy that URL and open it in a new tab ‚ûî this is our **Vulnerability Management Platform**.
<p align="center">
<img src="https://github.com/user-attachments/assets/e0c34343-fb5b-4e10-8062-c2560e0d2bc0" height="80%" width="80%" alt="9"/><br />
<br>

After we login, we can reset the password if we weren't able to login with the original one, and had to use **"Admin** as the pasword:
<p align="center">
<img src="https://github.com/user-attachments/assets/3b37e124-e61b-482b-9c67-4d8ec8ddf969" height="80%" width="80%" alt="9"/><br />
<br>

<br>
<br>

<h2>3Ô∏è‚É£ Create Client Virtual Machine and Make it Vulnerable</h2>
<br>


### Create Client Virtual Machine and Make it Vulnerable
<img width="752" alt="image" src="https://github.com/joshmadakor1/openvas/assets/39254979/493ed685-70f8-4260-84fb-037bd01c53fa">

1. Go to [Azure Portal](https://portal.azure.com)
2. Search for Virtual Machines and create a new Virtual Machine.
3. Configure the VM:
   - Resource Group: Vulnerability-Management
   - VM Name: Win10-Vulnerable
   - Region: Same as the OpenVAS VM (East US 2)
   - Virtual Network: Same as OpenVAS
   - Image: Windows 10 Pro
   - Size: Any size with 2 vCPUs
   - Username: azureuser / Cyberlab123!
   - Networking: Same Vnet as OpenVAS
4. Create the VM.
5. Once the VM is created, ensure you can RDP into it with the provided credentials.
6. After logging in, make the VM vulnerable:
   - Disable the Windows Firewall
   - Gather up some [Old Software](https://drive.google.com/drive/folders/1n83ilCjZWZulbDdYnUe9wQPK2buY47_U?usp=sharing)
   - Install an Old Version of FireFox: Firefox Setup 97.0b5
   - Install an Old Version of VLC Player: vlc-1.1.7-win32
   - Install an Old Version of Adobe Reader: 10.0_AdbeRdr1000_en_US_1_
   - Restart the VM.

### Configure OpenVAS to Perform First Unauthenticated Scan against our Vulnerable VM
<img width="730" alt="image" src="https://github.com/joshmadakor1/openvas/assets/39254979/8b3ca917-86d7-404c-94f6-b6402d391af4">

1. Login to OpenVAS and navigate to Assets > Hosts > New Host.
2. Add the Client VM PRIVATE IP Address.
3. Create a New Target from the Host, name it "Azure Vulnerable VMs".
4. Take note of the credentials. We will add SMB credentials later.
5. Create a new Task:
   - Name & Comment: "Scan - Azure Vulnerable VMs"
   - Scan Targets: "Azure Vulnerable VMs"
6. Save the Task.
7. Start the "Scan - Azure Vulnerable VMs" Task.
8. Once the scan is finished, click the date under "Last Report" to see the results.
9. Take note of the Tabs, especially the "Results" tab.

### Make Configurations for Credentialed Scans (Within VM)
<img width="508" alt="image" src="https://github.com/joshmadakor1/openvas/assets/39254979/2ce2ea53-b67b-4206-8050-fecce0a11c52">

1. Disable Windows Firewall.
2. Disable User Account Control.
3. Enable Remote Registry.
4. Set Registry Key:
   - Launch Registry Editor (regedit.exe) in "Run as administrator" mode.
   - Navigate to HKEY_LOCAL_MACHINE hive.
   - Open SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System key.
   - Create a new DWORD (32-bit) value with the following properties:
     - Name: LocalAccountTokenFilterPolicy
     - Value: 1
   - Close Registry Editor.
5. Restart the VM.

### Make Configurations for Credentialed Scans (OpenVAS)
<img width="722" alt="image" src="https://github.com/joshmadakor1/openvas/assets/39254979/474cb714-19ad-4c99-8e60-945a2a12d7e5">

1. Go to Configuration > Credentials > New Credential.
2. Name / Comment: "Azure VM Credentials".
3. Allow Insecure Use: Yes.
4. Username: azureuser.
5. Password: Cyberlab123!
6. Save.
7. Go to Configuration > Targets > CLONE the Target we made before.
8. NEW Name / Comment: "Azure Vulnerable VMs - Credentialed Scan".
9. Ensure the Private IP is still accurate.
10. Credentials > SMB > Select the Credentials we just made: Azure VM Credentials.
11. Save.

### Execute Credentialed Scan against our Vulnerable Windows VM
<img width="1126" alt="image" src="https://github.com/joshmadakor1/openvas/assets/39254979/83467078-e917-4eba-9757-745fe47b4ebf">

<img width="861" alt="image" src="https://github.com/joshmadakor1/openvas/assets/39254979/3b5cf494-829c-4eb0-bcfd-6d4372c97cd6">

1. Within Greenbone / OpenVAS, go to Scans > Tasks.
2. CLONE the "Scan - Azure Vulnerable VMs" Task and Edit it.
3. Name / Comment: "Scan - Azure Vulnerable VMs - Credentialed".
4. Targets: Azure Vulnerable VMs - Credentialed Scan.
5. Save.
6. Click the Play button to launch the new Credentialed Scan and wait for it to finish.

### Remediate Vulnerabilities
<img width="799" alt="image" src="https://github.com/joshmadakor1/openvas/assets/39254979/6b3835dc-11b1-4e00-b7a5-baa8049182f7">

1. Log back into your Win10-Vulnerable VM.
2. Uninstall Adobe Reader, VLC Player, and Firefox.
3. Restart the VM.
4. Re-initiate the "Scan - Azure Vulnerable VMs - Credentialed" scan and observe the results.

### Verify Remediations
<img width="1120" alt="image" src="https://github.com/joshmadakor1/openvas/assets/39254979/9efbd193-002a-49c2-9d9e-51f2cf1dc2af">

1. Note that there are no longer Vulnerabilities for FireFox, VLC Player, or Adobe Reader!
